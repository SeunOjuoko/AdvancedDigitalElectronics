//------------------------------------------------------------------------------------------------------
// Program SoC using C
// 1)Input from 8-bit switch and output to LEDs
// 2)Input characters from keyboard (UART) and output to the terminal
// 3)A counter is incremented from 1 to 10, and displayed on the VGA monitor
//------------------------------------------------------------------------------------------------------


#define AHB_TIMER_BASE        	0x52000000
#define AHB_TIMER_CONTROL		    0x52000008
#define AHB_GPIO_BASE         	0x53000000
#define AHB_GPIO_DIRECTION      0x53000004
#define NVIC_INT_ENABLE       	0xE000E100
#define NVIC_INT_PRIORITY0    	0xE000E400
#define AHBPMOD									0x55000000 
#define LUT_SIZE								250

unsigned int Current = 0;

const int sine_wave[LUT_SIZE] = {
	0x800,0x833,0x866,0x89a,0x8cd,0x900,0x933,0x966,
0x998,0x9cb,0x9fd,0xa2e,0xa60,0xa91,0xac1,0xaf1,
0xb21,0xb50,0xb7e,0xbac,0xbda,0xc07,0xc33,0xc5e,
0xc89,0xcb3,0xcdc,0xd05,0xd2c,0xd53,0xd79,0xd9e,
0xdc2,0xde6,0xe08,0xe29,0xe49,0xe69,0xe87,0xea4,
0xec0,0xedb,0xef5,0xf0e,0xf26,0xf3c,0xf51,0xf66,
0xf79,0xf8a,0xf9b,0xfaa,0xfb8,0xfc5,0xfd0,0xfdb,
0xfe4,0xfeb,0xff2,0xff7,0xffb,0xffe,0xfff,0xfff,
0xffe,0xffb,0xff7,0xff2,0xfeb,0xfe4,0xfdb,0xfd0,
0xfc5,0xfb8,0xfaa,0xf9b,0xf8a,0xf79,0xf66,0xf51,
0xf3c,0xf26,0xf0e,0xef5,0xedb,0xec0,0xea4,0xe87,
0xe69,0xe49,0xe29,0xe08,0xde6,0xdc2,0xd9e,0xd79,
0xd53,0xd2c,0xd05,0xcdc,0xcb3,0xc89,0xc5e,0xc33,
0xc07,0xbda,0xbac,0xb7e,0xb50,0xb21,0xaf1,0xac1,
0xa91,0xa60,0xa2e,0x9fd,0x9cb,0x998,0x966,0x933,
0x900,0x8cd,0x89a,0x866,0x833,0x800,0x7cc,0x799,
0x765,0x732,0x6ff,0x6cc,0x699,0x667,0x634,0x602,
0x5d1,0x59f,0x56e,0x53e,0x50e,0x4de,0x4af,0x481,
0x453,0x425,0x3f8,0x3cc,0x3a1,0x376,0x34c,0x323,
0x2fa,0x2d3,0x2ac,0x286,0x261,0x23d,0x219,0x1f7,
0x1d6,0x1b6,0x196,0x178,0x15b,0x13f,0x124,0x10a,
0xf1,0xd9,0xc3,0xae,0x99,0x86,0x75,0x64,
0x55,0x47,0x3a,0x2f,0x24,0x1b,0x14,0xd,
0x8,0x4,0x1,0x0,0x0,0x1,0x4,0x8,
0xd,0x14,0x1b,0x24,0x2f,0x3a,0x47,0x55,
0x64,0x75,0x86,0x99,0xae,0xc3,0xd9,0xf1,
0x10a,0x124,0x13f,0x15b,0x178,0x196,0x1b6,0x1d6,
0x1f7,0x219,0x23d,0x261,0x286,0x2ac,0x2d3,0x2fa,
0x323,0x34c,0x376,0x3a1,0x3cc,0x3f8,0x425,0x453,
0x481,0x4af,0x4de,0x50e,0x53e,0x56e,0x59f,0x5d1,
0x602,0x634,0x667,0x699,0x6cc,0x6ff,0x732,0x765,
0x799,0x7cc
}; //These values produce a sine wave using values 0-255
//Remove 'const'?

volatile static int i; //Place definition within main function or maybe above LUT?

void Timer_Handler()
{

	*(unsigned int*) (AHB_TIMER_BASE+0x0C) = 1;	//Clear timer interrupt request
	*(unsigned int*) AHBPMOD = sine_wave[Current];
	Current = Current + 1;
	if (Current == 250)
	{
		Current = 0;
	}
	//Push sample (Address Module and set it as the equal) 
	//*(unsigned int*) (AHB_GPIO_DIRECTION) = 0x01;		//GPIO write mode. Replace with AHB_GPIO_DIRECTION?
}//Verify values and add commentary

int main()
{
	i=0;
	
	*(unsigned int*) AHB_TIMER_BASE = 199;			  //Timer load register: =<clock frequency>
	*(unsigned int*) (AHB_TIMER_CONTROL) = 0x03;				//Timer 4-bits control register: [0]: timer enable, [1] mode (free-run or reload) [2]: prescaler
	//Replace AHB_TIMER_BASE+8 with AHB_TIMER_CONTROL and add address definition at top?
	*(unsigned int*) NVIC_INT_PRIORITY0 = 0x00000000;	//Priority: IRQ0(Timer): 0x00, IRQ1(UART): 0x40
  *(unsigned int*) NVIC_INT_ENABLE = 0x00000001;		//Enable interrupts for UART and timer

    while (1) {
							}	
	return 0;
} //Verify values and add commentary
